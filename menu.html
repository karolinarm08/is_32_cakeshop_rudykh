<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Schoolbell&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" type="image/x-icon" href="./image/favicon.ico">
    <title>Меню</title>        
</head>
<body>
<header>
    <nav id="nav" class="topnav">
        <div class="nav-logo"><a href="./index.html">RUBY</a></div>
        <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars"></i>
        </a>
        <div class="nav-main">
            <div class="nav-first">
                <a href="./menu.html" class="active">Меню</a>
                <a href="./index.html#about-us">Про нас</a>
                <a href="./news.html">Новини</a>
                <a href="./info.html">Інформація</a>
                <a href="./contacts.html">Контакти</a>
            </div>
            <div class="nav-second">
                <a href="./account.html"><i class="fa fa-user" aria-hidden="true"></i></a>
                <a href="./shoppingcart.html"><i class="fa fa-shopping-cart" aria-hidden="true"></i></a>
            </div>
        </div>   
    </nav>
</header>

<main>
    <div id="scrollToTopBtn"></div>
    <script src="code.js"></script>       

    <div class="banner">
        <img src="./image/waves_4.png" width="100%" alt="волны">
    </div>
    <div class="main">
        <h2 class="title">Меню</h2>
        <div class="menu filters">
            <div class="main-filters">            
                <button class="filter"><i class="fa fa-filter"></i></button>

                <button class="filter-button">НОВИНКИ</button>        
                <button class="filter-button">СЕЗОННІ ПРОПОЗИЦІЇ</button>
                <button class="filter-button">ТОРТИ</button>
                <button class="filter-button">МУСОВІ ТІСТЕЧКА</button>
                <button class="filter-button">ЕКЛЕРИ</button>
                <button class="filter-button">МАКАРОН</button>
                <button class="filter-button">ТАРТИ</button>
                <button class="filter-button">БАГАТОЯРУСНІ</button>
                <button class="filter-button">ЧІЗКЕЙКИ</button>
                <button class="filter-button">МУСОВІ ТОРТИ</button>
                <button class="filter-button">БЕНТО-ТОРТИ</button>
                <button class="filter-button">ШУ</button>
                <button class="filter-button">ПИРОГИ</button>
                <button class="filter-button">ЦУКЕРКИ</button>                
                <button class="filter-button drink">НАПОЇ</button>
            </div>
                <form class="search-form">
                    <input class="search-input" type="text" placeholder="Пошук...">
                    <button class="search-button" type="submit"><img src="./image/search.svg" alt=""></button>
                </form>
        </div>
        <div class="menu-cards-container" id="productsContainer">
            <a href="./product_change.html" class="add-container">
                <img src="./image/Group 76.jpg" alt="" class="add-button">
            </a>
            <!-- Тут будуть динамічно завантажуватися картки товарів -->
            <div id="loadingMessage" style="text-align: center; grid-column: span 3; font-size: 1.2em; color: var(--color-purple);">
                Завантаження товарів...
            </div>
        </div>
        <div class="cont">
            <button class="cont-button"><img src="./image/Line 1.png"></button>    
        </div>
    </div>
</main>
<div id="footer"></div>

<script>
    document.addEventListener('DOMContentLoaded', fetchProducts);

    function createProductCard(product) {
        // Генеруємо HTML для однієї картки товару
        const cardHtml = `
            <a href="./product.html?id=${product.id}" class="card-container">
                <img class="card-img" src="./${product.main_image}" 
                     onerror="this.onerror=null;this.src='./image/placeholder.png';" 
                     alt="${product.name}">
                <div class="card">
                    <div class="card-text">
                        <p class="card-name">${product.name}</p>
                        <p class="card-descr">${product.description}</p>
                    </div>
                    <div class="card-details">
                        <p class="card-weight">${product.weight} кг</p>
                        <p class="card-price">${product.price} грн</p>
                    </div>
                </div>
            </a>
        `;
        const div = document.createElement('div');
        div.innerHTML = cardHtml.trim();
        return div.firstChild;
    }

    async function fetchProducts() {
        const container = document.getElementById('productsContainer');
        const loadingMessage = document.getElementById('loadingMessage');
        // НОВИЙ МАРШРУТ: product_api.php?action=list
        const apiPath = window.location.origin + '/backend/product_api.php?action=list';

        try {
            const response = await fetch(apiPath);
            const data = await response.json();

            loadingMessage.style.display = 'none';

            if (data.success && data.products && data.products.length > 0) {
                // Очищаємо контейнер, але залишаємо кнопку "Додати" (яка є першим елементом)
                
                data.products.forEach(product => {
                    const card = createProductCard(product);
                    container.appendChild(card);
                });
            } else {
                // Якщо продуктів немає, показуємо повідомлення
                const noProducts = document.createElement('p');
                noProducts.style.textAlign = 'center';
                noProducts.style.gridColumn = 'span 3';
                noProducts.textContent = data.message || 'Наразі товарів у меню немає.';
                container.appendChild(noProducts);
            }

        } catch (error) {
            loadingMessage.textContent = 'Помилка завантаження меню. Перевірте підключення до API.';
            console.error("Помилка завантаження продуктів:", error);
        }
    }
</script>
</body>
</html>